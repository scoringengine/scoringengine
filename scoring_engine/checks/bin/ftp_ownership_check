#!/usr/bin/env python

# A King of the Hill scoring engine check that checks an ownership file on a
# fileserver to find a team's owernship hash. The hash should be the last line
# of the specified page.

import sys
import ftplib

if len(sys.argv) != 6:
    print('Usage: ' + sys.argv[0] + ' host port username password ownershipfilepath')
    sys.exit(1)

host = sys.argv[1]
port = sys.argv[2]
username = sys.argv[3]
password = sys.argv[4]
remote_filepath = sys.argv[5]

# Connect and check for file on the server
session = ftplib.FTP()
session.connect(host=host, port=int(port))
session.login(username, password)
downloaded_lines = []
download_response_text = session.retrlines('RETR {0}'.format(remote_filepath), downloaded_lines.append)
session.quit()
session.close()

# Success code is 226
if not download_response_text.startswith('226'):
    print('DOWN_OR_NO_HASH')
    print(download_response_text)
    sys.exit(1)

print(downloaded_lines[-1])
