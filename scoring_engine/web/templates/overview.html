{% extends 'base.html' %}
{% block title %}Overview{% endblock %}
{% block head %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dataTables.bootstrap.min.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dataTables.bootstrap.min.css') }}" />
    <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet">
{% endblock %}
{% block content %}
<div class="container">
  <div class="row">
    <table id="overview" class="table table-striped table-bordered table-compact" cellspacing="0" width="100%">
    </table>
    <div id='overview_api_reference'>Want a json formatted version of this data (including ip addresses)? <a href="{{ url_for('api.overview_data') }}">Here</a></div>
    <script>
        $(document).ready(function() {
            $.ajax({
                url: '/api/overview/get_data',
                dataType: 'json',
                success: function(data) {
                    var table = $('#overview').DataTable( {
                        ajax: "/api/overview/get_data",
                        columns: data.columns,
                        paging: false,
                        ordering: false,
                        info: false,
                        searching: false,
                        'createdRow': function ( row, data, index ) {
                            count = 0;
                            $('td', row).each(function() {
                                var value = $(this).html()
                                // Doing nothing if it's the current score
                                if (value.match(/^\d+$/)) {
                                }
                                else if (value.search('Team') == 0) {
                                }
                                else if (value.search('- True') > 0) {
                                    $('td', row).eq(count).addClass('label-success');
                                    $('td', row).eq(count).html(value.replace(' - True', ''));
                                }
                                else if (value.search('- False') > 0) {
                                    $('td', row).eq(count).addClass('label-danger');
                                    $('td', row).eq(count).html(value.replace(' - False', ''));
                                }
                                else {
                                    $('td', row).eq(count).addClass('label-default');
                                    $('td', row).eq(count).html('Undetermined');
                                }
                                count++;
                            })
                        }
                    });
                    setInterval( function () {
                        table.ajax.reload();
                    }, 5000 );
                }
            });
        });
    </script>
  </div>
</div>
{% endblock %}