{% extends 'base.html' %}
{% block title %}Overview{% endblock %}
{% block head %}
    {{ super() }}
    <script src="//cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
    <script src="//cdn.datatables.net/1.10.12/js/dataTables.bootstrap.min.js"></script>
    <link rel="stylesheet" href="//cdn.datatables.net/1.10.12/css/dataTables.bootstrap.min.css" />
{% endblock %}
{% block content %}
<div class="container">
  <div class="row">
    <table id="overview" class="table table-striped table-bordered table-compact" cellspacing="0" width="100%">
    </table>
    <script>
    function generateTable(columnDef) {
      var table = $('#overview').DataTable( {
        'createdRow': function ( row, data, index ) {
          count = 1;
          $.each(data, function(key, value) {
              if ( value == true ) {
                  $('td', row).eq(count).addClass('label-success');
                  $('td', row).eq(count).html('Pass');
              }
              else if (value == 0){
                  $('td', row).eq(count).addClass('label-default');
                  $('td', row).eq(count).html('0');
              }
              else if ( value == false ) {
                  $('td', row).eq(count).addClass('label-danger');
                  $('td', row).eq(count).html('Fail');
              }
              else{
                  $('td', row).eq(count).addClass('label-default');
                  $('td', row).eq(count).html('Undetermined');
              }
              count++;
          });
        },
        'ajax': '/api/overview/get_data',
        'columns': columnDef,
        'bDestroy': true,
        'bFilter': false,
        'bInfo': false,
        'order': [[ 1, 'desc' ]],
        'paging': false,
        'scrollX': true
      });
      table.draw();
    }
    </script>
    <script>
        (function drawOverview() {
            $.ajax({
                url: '/api/overview/get_data',
                dataType: 'json',
                success: function(data) {
                    // Generate our columns list to be passed to the generator
                    var columnsDef = []
                    $.each(data.columns, function(key, value) {
                        // columnsDef.push({"sTitle": value, "mData": value, "targets": [key]})
                        columnsDef.push({"title": value, "data": value})
                    });
                    //console.log(columnsDef);
                    generateTable(columnsDef);
                },
                error: function(data) {
                    console.log("Error: " + JSON.stringify(data));
                }
            }).then(function() {
                    setTimeout(drawOverview, 5000);
            });
        })();
    </script>
  </div>
</div>
{% endblock %}