{% extends 'base.html' %}
{% block title %}Overview{% endblock %}
{% block head %}
{{ super() }}
<style>
  .table td {
    text-align: center;
  }
</style>
{% endblock %}
{% block content %}
<div class="container">
  <div class="row">
    <h3 id="round_number" class="text-center gy-2"></h3>
    <h5 id="round_start" class="text-center"></h5>
  </div>
</div>
<div class="container-fluid">
  <div class="table-responsive">
    <table id="overview" class="table table-striped table-bordered table-sm" style="width:100%">
      <thead>
        <tr>
          <th></th>
          {% for team in teams %}
          <th class="text-center">{{ team.name }}</th>
          {% endfor %}
        </tr>
      </thead>
    </table>
  </div>
  <div id='hint'>Hover over status icon to get host:port information</div>
  <div id='overview_api_reference'>Want a json formatted version of this data (including ip addresses)? <a href="{{ url_for('api.overview_data') }}">Here</a></div>
</div>
{% endblock %}
{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='vendor/js/jquery.dataTables.min.js') }}"></script>
<script src="{{ url_for('static', filename='vendor/js/dataTables.bootstrap5.min.js') }}"></script>
<script>
  function refreshheader() {
    $.ajax({
      cache: false,
      url: '/api/overview/get_round_data',
      dataType: 'json',
      success: function (data) {
        $('#round_number').text("Round " + data.number);
        $('#round_start').text(data.round_start);
      }
    });
  };

  // Populate services table
  $(document).ready(function () {
    $('#overview').DataTable({
      'ajax': '/api/overview/get_data',
      'paging': false,
      'bSort': false,
      'info': false,
      'searching': false,
      'columnDefs': [
          { "width": "10%", "targets": 0 }
      ],
      'createdRow': function (row, data, index) {
        $('td', row).each(function () {
          $(this).addClass('my-0', 'py-0');
          var value = $(this).html();
          var column_num = $(this).index();
          switch (index) {
            // Current Score
            case 0:
              if (column_num == 0) {
                  var html_str = `<span style="font-weight:bold">${value}</span>`
                  $(this).html(html_str);
              } else {
                  var html_str = parseFloat(`${value}`).toLocaleString();
                  $(this).html(html_str);
              }
              break;
            // Current Place
            case 1:
              if (column_num == 0) {
                html_str = `<span style="font-weight:bold">${value}</span>`
                $(this).html(html_str);
              // Add Some Ribbons
              } else {
                if (value == 1) {
                  $(this).html(`${value} <i class="bi bi-trophy-fill" data-search-terms="achievement, award, cup, game, winner" style="color: #C98910; visibility: visible;"></i>`);
                } else if (value == 2) {
                  $(this).html(`${value} <i class="bi bi-trophy-fill" data-search-terms="achievement, award, cup, game, winner" style="color: #A8A8A8; visibility: visible;"></i>`);
                } else if (value == 3) {
                  $(this).html(`${value} <i class="bi bi-trophy-fill" data-search-terms="achievement, award, cup, game, winner" style="color: #965A38; visibility: visible;"></i>`);
                }
              }
              break;
            case 2:
              // Up and down services ratio
              if (column_num == 0) {
                  html_str = `<span style="font-weight:bold">${value}</span>`
                  $(this).html(html_str);
              } else {
                  html_str = `${value}`
                  $(this).html(html_str);
              }
              break;
            default:
              // Service Name
              if (column_num == 0) {
                  html_str = `<span style="font-weight:bold">${value}</span>`
                  $(this).html(html_str);
                  break;
              }

              if (value == 'true') {
                var image_icon = 'check-circle-fill';
                var image_color = 'green';
              }
              else if (value == 'false') {
                var image_icon = 'x-circle-fill';
                var image_color = 'red';
              }
              else {
                image_icon = 'question circle';
                image_color = 'black';
              }

              // html_str = `<span class="glyphicon ${image_icon}" style="color:${image_color}"></span>`;
              html_str = `<i class="bi bi-${image_icon}" style="color: ${image_color}"></i>`;
              // html_str = `<i class="bi-check-lg" style="font-size: 1rem; color: cornflowerblue;"></i>`;
              $(this).html(html_str);
          }
        })
      }
    });
  });

  $(document).ready(function () {
    // Disable datatables error reporting
    $.fn.dataTable.ext.errMode = 'none';

    // Populate our header
    refreshheader();
    setInterval(function () {
        refreshheader()
    }, 30000);

    setInterval(function () {
        overview.ajax.reload();
    }, 30000);
  });
</script>
{% endblock %}