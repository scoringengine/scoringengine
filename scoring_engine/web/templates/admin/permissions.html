{% extends 'admin/adminbase.html' %}
{% block title %}Admin - Website Permissions{% endblock %}

{% block header %}Website Permissions{% endblock %}

{% block admincontent %}
  <div class="pt-3">
    <div class="row">
      <div class="col-12 col-sm-6 col-md-5 mb-3">
        <h3 class="section-header">Blue Teams</h3>
        <div class="chart-card" style="padding:0; overflow:hidden;">
          <ul class="list-group list-group-flush">
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>Modify Service Hostname/IP</span>
              <div class="form-check form-switch mb-0">
                <input class="form-check-input permission-toggle" type="checkbox" role="switch"
                       data-url="{{ url_for('api.admin_update_blueteam_edit_hostname') }}"
                       {{ 'checked' if blue_team_update_hostname == true }}>
              </div>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>Modify Service Port</span>
              <div class="form-check form-switch mb-0">
                <input class="form-check-input permission-toggle" type="checkbox" role="switch"
                       data-url="{{ url_for('api.admin_update_blueteam_edit_port') }}"
                       {{ 'checked' if blue_team_update_port == true }}>
              </div>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>Modify Service Account Usernames</span>
              <div class="form-check form-switch mb-0">
                <input class="form-check-input permission-toggle" type="checkbox" role="switch"
                       data-url="{{ url_for('api.admin_update_blueteam_edit_account_usernames') }}"
                       {{ 'checked' if blue_team_update_account_usernames == true }}>
              </div>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>Modify Service Account Passwords</span>
              <div class="form-check form-switch mb-0">
                <input class="form-check-input permission-toggle" type="checkbox" role="switch"
                       data-url="{{ url_for('api.admin_update_blueteam_edit_account_passwords') }}"
                       {{ 'checked' if blue_team_update_account_passwords == true }}>
              </div>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>View Check Output</span>
              <div class="form-check form-switch mb-0">
                <input class="form-check-input permission-toggle" type="checkbox" role="switch"
                       data-url="{{ url_for('api.admin_update_blueteam_view_check_output') }}"
                       {{ 'checked' if blue_team_view_check_output == true }}>
              </div>
            </li>
          </ul>
        </div>
      </div>
      <div class="col-12 col-sm-6 col-md-5 mb-3">
        <h3 class="section-header">Scoreboard</h3>
        <div class="chart-card" style="padding:0; overflow:hidden;">
          <ul class="list-group list-group-flush">
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <span>Anonymize Team Names</span>
                <small class="d-block text-muted">Show random codenames (e.g., "Swift Falcon") instead of real names</small>
              </div>
              <div class="form-check form-switch mb-0">
                <input class="form-check-input permission-toggle" type="checkbox" role="switch"
                       data-url="{{ url_for('api.admin_update_anonymize_team_names') }}"
                       {{ 'checked' if anonymize_team_names == true }}>
              </div>
            </li>
          </ul>
        </div>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-4">
        <div class="panel panel-default">
          <div class="panel-heading">Scoreboard</div>
          <ul class="list-group">
            <li class="list-group-item">
              <form id="inject_scores_visible_form" method="POST" action="{{ url_for('api.admin_toggle_inject_scores_visible') }}" role="form">
                Show Inject Scores
                <div class="permission-switch pull-right">
                  <input id="inject_scores_visible" type="checkbox" onchange="$('#inject_scores_visible_form').submit();" {{ 'checked' if inject_scores_visible == true }}/>
                  <label for="inject_scores_visible" class="label-primary"></label>
                </div>
              </form>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    $(document).ready(function() {
      $('.permission-toggle').on('change', function() {
        var $toggle = $(this);
        var url = $toggle.data('url');

        // Disable while saving
        $toggle.prop('disabled', true);

        $.ajax({
          url: url,
          type: 'POST',
          success: function(response) {
            $toggle.prop('disabled', false);
            // Brief visual feedback
            $toggle.closest('.form-check').addClass('text-success');
            setTimeout(function() {
              $toggle.closest('.form-check').removeClass('text-success');
            }, 1000);
          },
          error: function(xhr) {
            $toggle.prop('disabled', false);
            // Revert the toggle on error
            $toggle.prop('checked', !$toggle.prop('checked'));
            alert('Error updating permission');
          }
        });
      });
    });
  </script>
{% endblock %}
