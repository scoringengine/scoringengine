{% extends 'base.html' %}
{% block content %}
<div class="max-w-6xl mx-auto p-4 md:flex md:space-x-6">
  <div class="md:w-1/4 mb-4 md:mb-0">
    <button id="engine_toggle" class="w-full mb-4 px-4 py-2 bg-gray-200 rounded">Pause</button>
    <div class="mb-4">
      <h3 class="font-semibold mb-2">Stats</h3>
      <nav class="flex flex-col space-y-1">
        <a class="px-3 py-2 rounded {% if request.path == '/admin/status' %}bg-gray-200{% endif %}" href="/admin/status" id="engine">Engine</a>
        <a class="px-3 py-2 rounded {% if request.path == '/admin/workers' %}bg-gray-200{% endif %}" href="/admin/workers">Workers</a>
        <a class="px-3 py-2 rounded {% if request.path == '/admin/queues' %}bg-gray-200{% endif %}" href="/admin/queues">Queues</a>
      </nav>
    </div>
    <div class="mb-4">
      <h3 class="font-semibold mb-2">Settings</h3>
      <nav class="flex flex-col space-y-1">
        <a class="px-3 py-2 rounded {% if request.path == '/admin/settings' %}bg-gray-200{% endif %}" href="/admin/settings">Competition</a>
        <a class="px-3 py-2 rounded {% if request.path == '/admin/permissions' %}bg-gray-200{% endif %}" href="/admin/permissions">Website Permissions</a>
        <a class="px-3 py-2 rounded {% if request.path == '/admin/manage' %}bg-gray-200{% endif %}" href="/admin/manage">Users</a>
      </nav>
    </div>
    <div class="mb-4">
      <h3 class="font-semibold mb-2">Injects</h3>
      <nav class="flex flex-col space-y-1">
        <a class="px-3 py-2 rounded {% if request.path == '/admin/injects/templates' %}bg-gray-200{% endif %}" href="/admin/injects/templates">Templates</a>
        <a class="px-3 py-2 rounded {% if request.path == '/admin/injects/scores' %}bg-gray-200{% endif %}" href="/admin/injects/scores">Scores</a>
      </nav>
    </div>
    <div class="mb-4">
      <h3 class="font-semibold mb-2">Services</h3>
      <nav class="flex flex-col">
        {% for team in blue_teams %}
        <div class="mb-1">
          <div class="font-semibold">{{team.name}}</div>
          <div class="ml-2">
            {% for service in team.services %}
            <a href="/admin/service/{{service.id}}" class="block px-2 py-1 text-sm rounded {% if service and request.path == '/admin/service/{0}'.format(service.id) %}bg-gray-200{% endif %}">{{service.name}}</a>
            {% endfor %}
          </div>
        </div>
        {% endfor %}
      </nav>
    </div>
  </div>
  <div class="md:flex-1">
    <h2 class="text-xl font-bold mb-4">{% block header %}{% endblock %}</h2>
    <div class="bg-white p-4 rounded shadow">
      {% block admincontent %}{% endblock %}
    </div>
  </div>
</div>
<script>
function getEngineStatus(){
  $.ajax({cache:false,url:'/api/admin/get_engine_paused',dataType:'json',success:function(data){
    if(!data.paused){
      $('#engine').html('Engine <span class="text-green-600">Running</span>');
      $('#engine_toggle').text('Pause').removeClass('bg-green-600').addClass('bg-red-600 text-white');
    }else{
      $('#engine').html('Engine <span class="text-gray-600">Paused</span>');
      $('#engine_toggle').text('Resume').removeClass('bg-red-600').addClass('bg-green-600 text-white');
    }
  }});
}
$(document).ready(function(){
  getEngineStatus();
  setInterval(function(){getEngineStatus()},30000);
  $('#engine_toggle').click(function(){
    $.ajax({cache:false,url:'/api/admin/toggle_engine',dataType:'json',type:'POST',success:function(){getEngineStatus();}});
  });
});
</script>
{% endblock %}
