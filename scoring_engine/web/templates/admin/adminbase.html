{% extends 'base.html' %}
{% block content %}
<div class="container text-center">
  <div class="row">
    <!-- Menu -->
    <div class="col-3 my-2">
      <!-- Start/Pause Engine -->
      <div class="list-group text-center">
        <button type="button" class="btn btn-secondary" id="engine_toggle"></button>
      </div>
      <!-- Stats -->
      <div class="card my-2">
        <div class="card-header">
          <div class="fs-5">Stats <i class="bi bi-bar-chart-fill"></i></div>
        </div>
        <ul class="list-group list-group-flush">
          <a class="list-group-item {% if request.path == '/admin/status' %}active{% endif %}"
            href="/admin/status" id="engine">Engine</a>
          <a class="list-group-item {% if request.path == '/admin/workers' %}active{% endif %}"
            href="/admin/workers">Workers</a>
          <a class="list-group-item {% if request.path == '/admin/queues' %}active{% endif %}"
            href="/admin/queues">Queues</a>
        </ul>
      </div>
      <!-- Settings -->
      <div class="card my-2">
        <div class="card-header">
          <div class="fs-5">Settings <i class="bi bi-gear-fill"></i></div>
        </div>
        <ul class="list-group list-group-flush">
          <a class="list-group-item {% if request.path == '/admin/settings' %}active{% endif %}"
            href="/admin/settings">Competition</a>
          <a class="list-group-item {% if request.path == '/admin/permissions' %}active{% endif %}"
            href="/admin/permissions">Website Permissions</a>
          <a class="list-group-item {% if request.path == '/admin/manage' %}active{% endif %}"
            href="/admin/manage">Users</a>
        </ul>
      </div>
      <!-- Injects -->
      <div class="card my-2">
        <div class="card-header">
          <div class="fs-5">Injects <i class="bi bi-file-earmark-ruled-fill"></i></div>
        </div>
        <ul class="list-group list-group-flush">
          <a class="list-group-item {% if request.path == '/admin/injects/templates' %}active{% endif %}"
          href="/admin/injects/templates">Templates</a>
          <a class="list-group-item {% if request.path == '/admin/injects/scores' %}active{% endif %}"
            href="/admin/injects/scores">Scores</a>
        </ul>
      </div>
      <!-- Services -->
      <div class="card my-2">
        <div class="card-header">
          <div class="fs-5">Services <i class="bi bi-list-task"></i></div>
        </div>
        <!-- Accordion -->
        <div class="accordion accordion-flush" id="accordionExample">
          {% for team in blue_teams %}
          <div class="accordion-item">
            <h2 class="accordion-header" id="flush-heading_{{ team.id }}">
              <button class="accordion-button {% if service and team.id != service.team.id %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse_{{ team.id }}">
              {{ team.name }}
              </button>
            </h2>
            <div id="flush-collapse_{{ team.id }}" class="accordion-collapse collapse {% if service and team.id == service.team.id %}show{% endif %}" data-bs-parent="#accordionFlushExample">
              <ul class="list-group list-group-flush">
                {% for service in team.services %}
                <a href="/admin/service/{{service.id}}"
                  class="list-group-item small {% if service and request.path == '/admin/service/{0}'.format(service.id) %}active{% endif %}"><span
                    class="glyphicon glyphicon-chevron-right"></span> {{service.name}}</a>
                {% endfor %}
              </ul>
            </div>
          </div>
          {% endfor %}
        </div>        
      </div>
    </div>
    <!-- Content -->
    <div class="col-9">
      {% block admincontent %}
      {% endblock %}
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
{{ super() }}
<script>
  function getEngineStatus() {
    $.ajax({
      cache: false,
      url: '/api/admin/get_engine_paused',
      dataType: 'json',
      success: function (data) {
        if (!data.paused) {
          document.getElementById('engine').innerHTML = 'Engine <span class="badge bg-success">Running</span>';
          document.getElementById('engine_toggle').innerHTML = '<i class="bi bi-pause-fill"></i> Pause'
          document.getElementById('engine_toggle').className = "btn btn-danger btn-lg";
        } else {
          document.getElementById('engine').innerHTML ='Engine <span class="badge bg-danger">Paused</span>';
          document.getElementById('engine_toggle').innerHTML = '<i class="bi bi-play-fill"></i> Resume'
          document.getElementById('engine_toggle').className = "btn btn-success btn-lg";
        }
      }
    });
  }

  $(document).ready(function () {
    getEngineStatus();
    setInterval(function () {
      getEngineStatus()
    }, 30000);
  });
</script>
<script>
  $("#engine_toggle").click(function(){
    $.ajax({
      cache: false,
      url: '/api/admin/toggle_engine',
      dataType: 'json',
      type: 'POST',
      success: function (data) {
        getEngineStatus();
      }
    });
  });
</script>
{% endblock %}