{% extends 'base.html' %}
{% block title %}Stats{% endblock %}
{% block head %}
{{ super() }}
<script src="{{ url_for('static', filename='vendor/js/dataTables.min.js') }}"></script>
<script src="{{ url_for('static', filename='vendor/js/dataTables.bootstrap5.min.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='vendor/css/dataTables.bootstrap5.min.css') }}" />
{% endblock %}
{% block content %}
<div class="container-fluid md-page">
    <div class="row">
        <h2 class="text-center">Round Stats</h2>
    </div>
    <div class="row">
        <div class="table-responsive">
        <table id="stats" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th>Round</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Duration</th>
                    <th>Service Ratio</th>
                </tr>
            </thead>
        </table>
        </div>
    </div>
</div>
<script>
    function formatDuration(seconds) {
        if (seconds < 60) {
            return seconds + 's';
        } else if (seconds < 3600) {
            var mins = Math.floor(seconds / 60);
            var secs = seconds % 60;
            return mins + 'm ' + secs + 's';
        } else {
            var hours = Math.floor(seconds / 3600);
            var mins = Math.floor((seconds % 3600) / 60);
            var secs = seconds % 60;
            return hours + 'h ' + mins + 'm ' + secs + 's';
        }
    }

    $('#stats').DataTable( {
        ajax: '/api/stats',
        order: [[0, 'desc']],
        columns: [
            { data: 'round_id' },
            { data: 'start_time' },
            { data: 'end_time' },
            {
                data: 'total_seconds',
                render: function(data, type, row) {
                    if (type === 'display') {
                        return formatDuration(data);
                    }
                    return data; // Keep raw value for sorting
                }
            },
        ],
        "columnDefs": [{
            "targets": 4,
            "data": null,
            "render": function ( data, type, row, meta ) {
                return row.num_up_services + ' <i class="bi bi-chevron-up text-success" aria-hidden="true"></i> / ' + row.num_down_services + ' <i class="bi bi-chevron-down text-danger" aria-hidden="true"></i>';
            }
        }]
    } );
</script>
{% endblock %}