{% extends "base.html" %}
{% block title %}Scoreboard{% endblock %}
{% block content %}
<div class="container">
  <div class="row my-3">
    <div class="card">
      <div class="card-body">
        <div style="height: 400px">
          <canvas id="barScores"></canvas>
        </div>
      </div>
    </div>
  </div>
  <div class="row my-3">
    <div class="card">
      <div class="card-body">
        <div style="height: 400px">
          <canvas id="lineScores"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
{{ super() }}
<!-- <script src="{{ url_for('static', filename='vendor/js/chart.min.js') }}"></script> -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Bar Chart
  function updateBarChart(chart) {
    $.getJSON("/api/scoreboard/get_bar_data").done(function(response) {
      chart.data.labels = response.labels;
      chart.data.datasets = [{
        label: "Services",
        data: response.service_scores
      },
      {
        label: "Injects",
        data: response.inject_scores
      }];
      chart.update();
    });
  };

  const barChart = new Chart(document.getElementById('barScores'), {
    type: 'bar',
    options: {
      interaction: {
        mode: 'index'
      },
      maintainAspectRatio: false,
      plugins: {
        title: {
          display: true,
          text: 'Total Scores',
        }
      },
      responsive: true,
      scales: {
        x: {
          stacked: true
        },
        y: {
          stacked: true
        }
      },
    }
  });

  updateBarChart(barChart);
  setInterval(updateBarChart, 30000, barChart);
  
  // Line Chart
  function updateLineChart(chart) {
    $.getJSON("/api/scoreboard/get_line_data").done(function(response) {
      chart.data.labels = response.rounds;
      var datasets = [];
      response.team.forEach((team) => {
        datasets.push({
          label: team.name,
          data: team.scores,
          borderColor: team.color,
          backgroundColor: team.color,
          fill: false
        });
      });
      chart.data.datasets = datasets;
      chart.update();
    });
  };
  
  const lineChart = new Chart(document.getElementById('lineScores'), {
    type: 'line',
    options: {
      animation: {     
        y: {
          duration: 0 
        },
      },
      elements: {
        point: {
          pointStyle: false,
        }
      },
      interaction: {
        mode: 'index'
      },
      maintainAspectRatio: false,
      plugins: {
        title: {
          display: true,
          text: 'Service Scores',
        }
      },
      responsive: true,
    }
  });

  $(document).ready(function () {
    updateLineChart(lineChart);
    setInterval(updateLineChart, 30000, lineChart);
  });
</script>
{% endblock %}